import React, { useEffect, useState } from "react";
import PageMainLayout from "../layout/PageMainLayout";
import client from "../services/contentfulClient";

const StopExploitationPage = () => {
  const [links, setLinks] = useState();
  const [error, setError] = useState(false);
  const [isLoading, setIsLoading] = useState(false);

  const getLinks = async () => {
    setError(false);
    try {
      const liens = await client.getEntries({
        content_type: "ethicLink",
        order: "sys.createdAt",
      });
      console.log(
        "üöÄ ~ file: StopExploitationPage.jsx:17 ~ getLinks ~ liens",
        liens
      );
      setLinks(liens.items);
    } catch (error) {
      setError(true);
    }
  };

  useEffect(() => {
    setIsLoading(true);
    getLinks().then(() => setIsLoading(false));
  }, []);

  if (isLoading) return <div>Chargement...</div>;

  if (!isLoading && error)
    return (
      <div>Une erreur est survenue dans la r√©cup√©rations des informations.</div>
    );

  return (
    <PageMainLayout>
      <div className="text-center mb-12">
        <h1 className="text-5xl mb-24 font-bold">
          Pourquoi ne plus exploiter les animaux ?
        </h1>
      </div>
      {links &&
        links.map((link) => (
          <a
            key={link.sys.id}
            href={link.fields.lien}
            target="_blank"
            rel="noreferrer"
          >
            <div className="mb-16">
              <div className="flex flex-col lg:flex-row">
                <img
                  src={`https:${link.fields.image.fields.file.url}`}
                  alt="stop animal exploitation"
                />
                <div className="w-full mt-4 lg:mt-0 lg:ml-4 lg:w-auto">
                  <p className="text-2xl text-blue-600 mb-2 block">
                    {link.fields.titre}
                  </p>
                  <p className="mb-6">{link.fields.description}</p>
                  {link.fields.lien && (
                    <p>
                      Lien du contenu :{" "}
                      <a
                        href={link.fields.lien}
                        target="_blank"
                        rel="noreferrer"
                        className="text-gray-500"
                      >
                        {link.fields.lien}
                      </a>
                    </p>
                  )}
                </div>
              </div>
            </div>
          </a>
        ))}
    </PageMainLayout>
  );
};

export default StopExploitationPage;
